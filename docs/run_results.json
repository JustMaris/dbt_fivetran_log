{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v5.json", "dbt_version": "1.7.3", "generated_at": "2023-12-12T19:08:32.891443Z", "invocation_id": "c0fa594b-cab7-478a-aeb0-a325788070ef", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:29.583275Z", "completed_at": "2023-12-12T19:08:29.596288Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:29.597120Z", "completed_at": "2023-12-12T19:08:29.597133Z"}], "thread_id": "Thread-1", "execution_time": 0.016467809677124023, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.stg_fivetran_platform__account", "compiled": true, "compiled_code": "with base as (\n    \n    select * \n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1.account\n),\n\nfields as (\n\n    select\n        id as account_id,\n        country,\n        cast(created_at as timestamp) as created_at,\n        name as account_name,\n        status\n    from base\n)\n\nselect * \nfrom fields", "relation_name": "DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__account"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:29.599824Z", "completed_at": "2023-12-12T19:08:29.604343Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:29.605132Z", "completed_at": "2023-12-12T19:08:29.605138Z"}], "thread_id": "Thread-1", "execution_time": 0.0069370269775390625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.stg_fivetran_platform__connector_tmp", "compiled": true, "compiled_code": "select *\nfrom DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1.connector", "relation_name": "DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__connector_tmp"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:29.607589Z", "completed_at": "2023-12-12T19:08:29.615707Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:29.616388Z", "completed_at": "2023-12-12T19:08:29.616395Z"}], "thread_id": "Thread-1", "execution_time": 0.010297775268554688, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.stg_fivetran_platform__credits_used", "compiled": true, "compiled_code": "\n\nwith base as (\n\n    select * \n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1.credits_used\n),\n\nfields as (\n    \n    select \n        destination_id,\n        measured_month,\n        credits_consumed as credits_spent\n    from base\n)\n\nselect * \nfrom fields\n\n", "relation_name": "DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__credits_used"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:29.618679Z", "completed_at": "2023-12-12T19:08:29.622466Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:29.623073Z", "completed_at": "2023-12-12T19:08:29.623078Z"}], "thread_id": "Thread-1", "execution_time": 0.005653858184814453, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.stg_fivetran_platform__destination", "compiled": true, "compiled_code": "with base as (\n\n    select * \n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1.destination\n),\n\nfields as (\n\n    select\n        id as destination_id,\n        account_id,\n        cast(created_at as timestamp) as created_at,\n        name as destination_name,\n        region\n    from base\n)\n\nselect * \nfrom fields", "relation_name": "DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__destination"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:29.625052Z", "completed_at": "2023-12-12T19:08:29.629175Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:29.629747Z", "completed_at": "2023-12-12T19:08:29.629751Z"}], "thread_id": "Thread-1", "execution_time": 0.005950212478637695, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.stg_fivetran_platform__destination_membership", "compiled": true, "compiled_code": "\n\nwith base as (\n    \n    select * from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1.destination_membership\n),\n\nfields as (\n\n    select\n        destination_id,\n        user_id,\n        cast(activated_at as timestamp) as activated_at,\n        cast(joined_at as timestamp) as joined_at,\n        role as destination_role\n    from base\n)\n\nselect * \nfrom fields", "relation_name": "DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__destination_membership"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:29.631597Z", "completed_at": "2023-12-12T19:08:29.635190Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:29.635757Z", "completed_at": "2023-12-12T19:08:29.635762Z"}], "thread_id": "Thread-1", "execution_time": 0.005378007888793945, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.stg_fivetran_platform__incremental_mar", "compiled": true, "compiled_code": "with base as (\n\n    select * \n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1.incremental_mar\n),\n\nfields as (\n\n    select\n        connector_id as connector_name,\n        destination_id,\n        free_type,\n        cast(measured_date as timestamp) as measured_date,\n        schema_name,\n        sync_type,\n        table_name,\n        updated_at,\n        _fivetran_synced,\n        incremental_rows\n    from base\n)\n\nselect * \nfrom fields", "relation_name": "DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__incremental_mar"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:29.637571Z", "completed_at": "2023-12-12T19:08:29.640593Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:29.641133Z", "completed_at": "2023-12-12T19:08:29.641139Z"}], "thread_id": "Thread-1", "execution_time": 0.004690885543823242, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.stg_fivetran_platform__log_tmp", "compiled": true, "compiled_code": "select *\nfrom DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1.log", "relation_name": "DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__log_tmp"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:29.642917Z", "completed_at": "2023-12-12T19:08:29.647520Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:29.648054Z", "completed_at": "2023-12-12T19:08:29.648059Z"}], "thread_id": "Thread-1", "execution_time": 0.006251096725463867, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.stg_fivetran_platform__usage_cost", "compiled": true, "compiled_code": "\nwith base as (\n\n    select * \n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1.usage_cost\n),\n\nfields as (\n    \n    select \n        destination_id,\n        measured_month,\n        amount as dollars_spent\n    from base\n)\n\nselect * \nfrom fields\n\n", "relation_name": "DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__usage_cost"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:29.649748Z", "completed_at": "2023-12-12T19:08:29.653285Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:29.653815Z", "completed_at": "2023-12-12T19:08:29.653820Z"}], "thread_id": "Thread-1", "execution_time": 0.00515294075012207, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.stg_fivetran_platform__user", "compiled": true, "compiled_code": "\n\nwith base as (\n\n    select * \n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1.user\n),\n\nfields as (\n\n    select\n        id as user_id,\n        cast(created_at as timestamp) as created_at,\n        email,\n        email_disabled as has_disabled_email_notifications,\n        family_name as last_name,\n        given_name as first_name,\n        phone,\n        verified as is_verified\n    from base\n)\n\nselect * \nfrom fields", "relation_name": "DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__user"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:29.655632Z", "completed_at": "2023-12-12T19:08:29.657197Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:29.657937Z", "completed_at": "2023-12-12T19:08:29.657946Z"}], "thread_id": "Thread-1", "execution_time": 0.0037610530853271484, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.fivetran_log_integration_tests.account", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:29.659975Z", "completed_at": "2023-12-12T19:08:29.661369Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:29.661999Z", "completed_at": "2023-12-12T19:08:29.662005Z"}], "thread_id": "Thread-1", "execution_time": 0.003264904022216797, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.fivetran_log_integration_tests.connector", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:29.663981Z", "completed_at": "2023-12-12T19:08:29.665987Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:29.666537Z", "completed_at": "2023-12-12T19:08:29.666542Z"}], "thread_id": "Thread-1", "execution_time": 0.0037810802459716797, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.fivetran_log_integration_tests.credits_used", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:29.668142Z", "completed_at": "2023-12-12T19:08:29.669323Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:29.669837Z", "completed_at": "2023-12-12T19:08:29.669841Z"}], "thread_id": "Thread-1", "execution_time": 0.0027382373809814453, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.fivetran_log_integration_tests.destination", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:29.671560Z", "completed_at": "2023-12-12T19:08:29.672852Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:29.673431Z", "completed_at": "2023-12-12T19:08:29.673435Z"}], "thread_id": "Thread-1", "execution_time": 0.0030248165130615234, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.fivetran_log_integration_tests.destination_membership", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:29.675410Z", "completed_at": "2023-12-12T19:08:29.676786Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:29.677317Z", "completed_at": "2023-12-12T19:08:29.677322Z"}], "thread_id": "Thread-1", "execution_time": 0.0032188892364501953, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.fivetran_log_integration_tests.incremental_mar", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:29.678940Z", "completed_at": "2023-12-12T19:08:29.680184Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:29.680661Z", "completed_at": "2023-12-12T19:08:29.680665Z"}], "thread_id": "Thread-1", "execution_time": 0.00272369384765625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.fivetran_log_integration_tests.log", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:29.682192Z", "completed_at": "2023-12-12T19:08:29.684052Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:29.684555Z", "completed_at": "2023-12-12T19:08:29.684561Z"}], "thread_id": "Thread-1", "execution_time": 0.0034568309783935547, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.fivetran_log_integration_tests.usage_cost", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:29.686240Z", "completed_at": "2023-12-12T19:08:29.687484Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:29.688000Z", "completed_at": "2023-12-12T19:08:29.688004Z"}], "thread_id": "Thread-1", "execution_time": 0.002780914306640625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.fivetran_log_integration_tests.user", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:29.689570Z", "completed_at": "2023-12-12T19:08:29.697474Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:29.697983Z", "completed_at": "2023-12-12T19:08:29.697987Z"}], "thread_id": "Thread-1", "execution_time": 0.009428024291992188, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.not_null_stg_fivetran_platform__account_account_id.d09ebf1a1e", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect account_id\nfrom DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__account\nwhere account_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:29.699648Z", "completed_at": "2023-12-12T19:08:29.703938Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:29.704438Z", "completed_at": "2023-12-12T19:08:29.704442Z"}], "thread_id": "Thread-1", "execution_time": 0.00582122802734375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.unique_stg_fivetran_platform__account_account_id.114e181adc", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    account_id as unique_field,\n    count(*) as n_records\n\nfrom DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__account\nwhere account_id is not null\ngroup by account_id\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:29.706035Z", "completed_at": "2023-12-12T19:08:30.181914Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:30.182785Z", "completed_at": "2023-12-12T19:08:30.182793Z"}], "thread_id": "Thread-1", "execution_time": 0.5884549617767334, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.stg_fivetran_platform__connector", "compiled": true, "compiled_code": "with base as (\n\n    select * \n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__connector_tmp\n),\n\nfields as (\n    select\n        \n    cast(null as boolean) as \n    \n    _fivetran_deleted\n    \n , \n    \n    \n    _fivetran_synced\n    \n as \n    \n    _fivetran_synced\n    \n, \n    \n    \n    connecting_user_id\n    \n as \n    \n    connecting_user_id\n    \n, \n    \n    \n    connector_id\n    \n as \n    \n    connector_id\n    \n, \n    \n    \n    connector_name\n    \n as \n    \n    connector_name\n    \n, \n    \n    \n    connector_type\n    \n as \n    \n    connector_type\n    \n, \n    cast(null as TEXT) as \n    \n    connector_type_id\n    \n , \n    \n    \n    destination_id\n    \n as \n    \n    destination_id\n    \n, \n    \n    \n    paused\n    \n as \n    \n    paused\n    \n, \n    cast(null as integer) as \n    \n    service_version\n    \n , \n    \n    \n    signed_up\n    \n as \n    \n    signed_up\n    \n\n\n\n        ,row_number() over ( partition by connector_name, destination_id order by _fivetran_synced desc ) as nth_last_record\n    from base\n),\n\nfinal as (\n\n    select \n        connector_id,\n        connector_name,\n        coalesce(connector_type_id, connector_type) as connector_type,\n        destination_id,\n        connecting_user_id,\n        paused as is_paused,\n        signed_up as set_up_at\n    from fields\n\n    -- Only look at the most recent one\n    where nth_last_record = 1\n)\n\nselect * \nfrom final", "relation_name": "DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__connector"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:30.297083Z", "completed_at": "2023-12-12T19:08:30.309610Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:30.310462Z", "completed_at": "2023-12-12T19:08:30.310469Z"}], "thread_id": "Thread-1", "execution_time": 0.01565098762512207, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.dbt_utils_unique_combination_of_columns_stg_fivetran_platform__credits_used_measured_month__destination_id.bea8f20c38", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        measured_month, destination_id\n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__credits_used\n    group by measured_month, destination_id\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:30.313185Z", "completed_at": "2023-12-12T19:08:30.318491Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:30.319211Z", "completed_at": "2023-12-12T19:08:30.319216Z"}], "thread_id": "Thread-1", "execution_time": 0.007678031921386719, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.not_null_stg_fivetran_platform__destination_destination_id.0cdbe6b780", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect destination_id\nfrom DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__destination\nwhere destination_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:30.321551Z", "completed_at": "2023-12-12T19:08:30.325638Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:30.326315Z", "completed_at": "2023-12-12T19:08:30.326321Z"}], "thread_id": "Thread-1", "execution_time": 0.006234884262084961, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.unique_stg_fivetran_platform__destination_destination_id.582a1280ed", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    destination_id as unique_field,\n    count(*) as n_records\n\nfrom DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__destination\nwhere destination_id is not null\ngroup by destination_id\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:30.328476Z", "completed_at": "2023-12-12T19:08:30.332995Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:30.333612Z", "completed_at": "2023-12-12T19:08:30.333617Z"}], "thread_id": "Thread-1", "execution_time": 0.006437778472900391, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.dbt_utils_unique_combination_of_columns_stg_fivetran_platform__destination_membership_destination_id__user_id.82ac27c35a", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        destination_id, user_id\n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__destination_membership\n    group by destination_id, user_id\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:30.335526Z", "completed_at": "2023-12-12T19:08:30.852282Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:30.853331Z", "completed_at": "2023-12-12T19:08:30.853348Z"}], "thread_id": "Thread-1", "execution_time": 0.6241931915283203, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.stg_fivetran_platform__log", "compiled": true, "compiled_code": "with base as (\n\n    select * \n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__log_tmp\n),\n\nfields as (\n    select\n        \n    \n    \n    _fivetran_synced\n    \n as \n    \n    _fivetran_synced\n    \n, \n    \n    \n    connector_id\n    \n as \n    \n    connector_id\n    \n, \n    \n    \n    event\n    \n as \n    \n    event\n    \n, \n    \n    \n    id\n    \n as \n    \n    id\n    \n, \n    \n    \n    message_data\n    \n as \n    \n    message_data\n    \n, \n    \n    \n    message_event\n    \n as \n    \n    message_event\n    \n, \n    \n    \n    sync_id\n    \n as \n    \n    sync_id\n    \n, \n    \n    \n    time_stamp\n    \n as \n    \n    time_stamp\n    \n, \n    \n    \n    transformation_id\n    \n as \n    \n    transformation_id\n    \n\n\n\n    from base\n),\n\nfinal as (\n\n    select\n        id as log_id, \n        sync_id,\n        cast(time_stamp as timestamp) as created_at,\n        connector_id, -- Note: the connector_id column used to erroneously equal the connector_name, NOT its id.\n        case when transformation_id is not null and event is null then 'TRANSFORMATION'\n        else event end as event_type, \n        message_data,\n        case \n        when transformation_id is not null and message_data like '%has succeeded%' then 'transformation run success'\n        when transformation_id is not null and message_data like '%has failed%' then 'transformation run failed'\n        else message_event end as event_subtype,\n        transformation_id\n    from fields\n)\n\nselect * \nfrom final", "relation_name": "DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__log"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:30.963549Z", "completed_at": "2023-12-12T19:08:30.972244Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:30.973344Z", "completed_at": "2023-12-12T19:08:30.973353Z"}], "thread_id": "Thread-1", "execution_time": 0.012953042984008789, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.dbt_utils_unique_combination_of_columns_stg_fivetran_platform__usage_cost_measured_month__destination_id.d6d997525f", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        measured_month, destination_id\n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__usage_cost\n    group by measured_month, destination_id\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:30.976632Z", "completed_at": "2023-12-12T19:08:30.982543Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:30.983388Z", "completed_at": "2023-12-12T19:08:30.983394Z"}], "thread_id": "Thread-1", "execution_time": 0.008631229400634766, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.not_null_stg_fivetran_platform__user_user_id.eb17e92ff0", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect user_id\nfrom DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__user\nwhere user_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:30.985990Z", "completed_at": "2023-12-12T19:08:30.990905Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:30.991611Z", "completed_at": "2023-12-12T19:08:30.991617Z"}], "thread_id": "Thread-1", "execution_time": 0.0071811676025390625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.unique_stg_fivetran_platform__user_user_id.86a1a3afb9", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    user_id as unique_field,\n    count(*) as n_records\n\nfrom DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__user\nwhere user_id is not null\ngroup by user_id\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:30.993932Z", "completed_at": "2023-12-12T19:08:31.000774Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:31.001429Z", "completed_at": "2023-12-12T19:08:31.001435Z"}], "thread_id": "Thread-1", "execution_time": 0.008944988250732422, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.fivetran_platform__mar_table_history", "compiled": true, "compiled_code": "with incremental_mar as (\n\n    select\n        *,\n        date_trunc('month', measured_date) as measured_month\n\n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__incremental_mar\n),\n\nconnector as (\n\n    select *\n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__connector\n),\n\ndestination as (\n\n    select *\n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__destination\n),\n\nordered_mar as (\n\n    select\n        connector_name,\n        schema_name,\n        table_name,\n        destination_id,\n        measured_month,\n        max(measured_date) as last_measured_at,\n        sum(incremental_rows) as incremental_rows,\n        sum(coalesce(case when lower(free_type) = 'paid'\n            then incremental_rows\n        end, 0)) as paid_monthly_active_rows,\n        sum(coalesce(case when lower(free_type) != 'paid'\n            then incremental_rows\n        end, 0)) as free_monthly_active_rows\n\n    from incremental_mar\n    group by connector_name, schema_name, table_name, destination_id, measured_month\n),\n\nlatest_mar as (\n    select \n        connector_name,\n        schema_name,\n        table_name,\n        destination_id,\n        measured_month,\n        cast(last_measured_at as date) as last_measured_at,\n        free_monthly_active_rows,\n        paid_monthly_active_rows,\n        (free_monthly_active_rows + paid_monthly_active_rows) as total_monthly_active_rows\n\n    from ordered_mar\n),\n\nmar_join as (\n\n    select\n        latest_mar.*,\n        connector.connector_type,\n        connector.connector_id,\n        destination.destination_name\n\n    from latest_mar\n    join connector\n        on latest_mar.connector_name = connector.connector_name\n        and latest_mar.destination_id = connector.destination_id\n    join destination on latest_mar.destination_id = destination.destination_id\n)\n\nselect * from mar_join\n -- can't order CTEs in sqlserver\norder by measured_month desc, destination_id, connector_name\n", "relation_name": "DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.fivetran_platform__mar_table_history"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:31.003631Z", "completed_at": "2023-12-12T19:08:31.008119Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:31.008761Z", "completed_at": "2023-12-12T19:08:31.008766Z"}], "thread_id": "Thread-1", "execution_time": 0.0064868927001953125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.dbt_utils_unique_combination_of_columns_stg_fivetran_platform__connector_connector_name__destination_id.38a4da659a", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        connector_name, destination_id\n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__connector\n    group by connector_name, destination_id\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:31.010675Z", "completed_at": "2023-12-12T19:08:31.022245Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:31.022815Z", "completed_at": "2023-12-12T19:08:31.022820Z"}], "thread_id": "Thread-1", "execution_time": 0.01335287094116211, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.fivetran_platform__audit_user_activity", "compiled": true, "compiled_code": "with logs as (\n\n    select \n        *,\n        \n\n  parse_json( message_data )['actor'] as actor_email\n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__log\n),\n\nuser_logs as (\n\n    select *\n    from logs\n    where actor_email is not null \n        and lower(actor_email) != 'fivetran'\n),\n\nconnector as (\n\n    select *\n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__connector\n),\n\ndestination as (\n\n    select *\n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__destination\n),\nusers as (\n\n    select *\n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__user\n),\n    destination_membership as (\n\n        select *\n        from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__destination_membership\n    ),\n    final as (\n\n    select\n        date_trunc('day', user_logs.created_at) as date_day,\n        \n        dayname(user_logs.created_at) as day_name,\n            date_part('day', user_logs.created_at) as day_of_month,\n        user_logs.created_at as occurred_at,\n        destination.destination_name,\n        destination.destination_id,\n        connector.connector_name,\n        connector.connector_id,\n        user_logs.actor_email as email,\n        users.first_name,\n        users.last_name,\n        users.user_id,\n        destination_membership.destination_role,\n    user_logs.event_type, -- should always be INFO for user-triggered actions but include just in case\n        user_logs.event_subtype,\n        user_logs.message_data,\n        user_logs.log_id\n\n    from user_logs\n    left join connector\n        on user_logs.connector_id = connector.connector_id\n    left join destination\n        on connector.destination_id = destination.destination_id\n    left join users \n        on lower(users.email) = lower(user_logs.actor_email)\n    left join destination_membership\n        on destination.destination_id = destination_membership.destination_id\n        and users.user_id = destination_membership.user_id\n\n    )\n\nselect *\nfrom final", "relation_name": "DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.fivetran_platform__audit_user_activity"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:31.024698Z", "completed_at": "2023-12-12T19:08:31.037061Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:31.037576Z", "completed_at": "2023-12-12T19:08:31.037581Z"}], "thread_id": "Thread-1", "execution_time": 0.014023780822753906, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.fivetran_platform__connector_status", "compiled": true, "compiled_code": "with transformation_removal as (\n\n    select *\n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__log\n    where transformation_id is null\n\n),\n\nconnector_log as (\n    select \n        *,\n        sum( case when event_subtype in ('sync_start') then 1 else 0 end) over ( partition by connector_id \n            order by created_at rows unbounded preceding) as sync_batch_id\n    from transformation_removal\n    -- only looking at errors, warnings, and syncs here\n    where event_type = 'SEVERE'\n        or event_type = 'WARNING'\n        or event_subtype like 'sync%'\n        or (event_subtype = 'status' \n            and \n\n  parse_json( message_data )['status'] = 'RESCHEDULED'\n            \n            and \n\n  parse_json( message_data )['reason'] like '%intended behavior%'\n            ) -- for priority-first syncs. these should be captured by event_type = 'WARNING' but let's make sure\n        or (event_subtype = 'status' \n            and \n\n  parse_json( message_data )['status'] = 'SUCCESSFUL'\n        )\n        -- whole reason is \"We have rescheduled the connector to force flush data from the forward sync into your destination. This is intended behavior and means that the connector is working as expected.\"\n),\n\nschema_changes as (\n\n    select\n        connector_id,\n        count(*) as number_of_schema_changes_last_month\n\n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__log\n\n    where \n        datediff(\n        day,\n        created_at,\n        \n  current_timestamp::timestamp\n\n        ) <= 30\n        and event_subtype in ('create_table', 'alter_table', 'create_schema', 'change_schema_config')\n\n    group by connector_id\n\n),\n\nconnector as (\n\n    select *\n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__connector\n\n),\n\ndestination as (\n\n    select * \n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__destination\n),\n\nconnector_metrics as (\n\n    select\n        connector.connector_id,\n        connector.connector_name,\n        connector.connector_type,\n        connector.destination_id,\n        connector.is_paused,\n        connector.set_up_at,\n        max(case when connector_log.event_subtype = 'sync_start' then connector_log.created_at else null end) as last_sync_started_at,\n\n        max(case when connector_log.event_subtype = 'sync_end' \n            then connector_log.created_at else null end) as last_sync_completed_at,\n\n        max(case when connector_log.event_subtype in ('status', 'sync_end')\n                and \n\n  parse_json( connector_log.message_data )['status'] ='SUCCESSFUL'\n            then connector_log.created_at else null end) as last_successful_sync_completed_at,\n\n\n        max(case when connector_log.event_subtype = 'sync_end' \n            then connector_log.sync_batch_id else null end) as last_sync_batch_id,\n\n        max(case when connector_log.event_subtype in ('status', 'sync_end')\n                and \n\n  parse_json( connector_log.message_data )['status'] ='RESCHEDULED'\n                and \n\n  parse_json( connector_log.message_data )['reason'] like '%intended behavior%'\n            then connector_log.created_at else null end) as last_priority_first_sync_completed_at,\n                \n\n        max(case when connector_log.event_type = 'SEVERE' then connector_log.created_at else null end) as last_error_at,\n\n        max(case when connector_log.event_type = 'SEVERE' then connector_log.sync_batch_id else null end) as last_error_batch,\n        max(case when event_type = 'WARNING' then connector_log.created_at else null end) as last_warning_at\n\n    from connector \n    left join connector_log \n        on connector_log.connector_id = connector.connector_id\n    group by connector.connector_id, connector.connector_name, connector.connector_type, connector.destination_id, connector.is_paused, connector.set_up_at\n),\n\nconnector_health_status as (\n\n    select\n        *,\n        case \n            -- connector is paused\n            when is_paused  then 'paused'\n\n            -- a sync has never been attempted\n            when last_sync_started_at is null then 'incomplete'\n\n            -- a priority-first sync has occurred, but a normal sync has not\n            when last_priority_first_sync_completed_at is not null and last_sync_completed_at is null then 'priority first sync'\n\n            -- a priority sync has occurred more recently than a normal one (may occurr if the connector has been paused and resumed)\n            when last_priority_first_sync_completed_at > last_sync_completed_at then 'priority first sync'\n\n            -- a sync has been attempted, but not completed, and it's not due to errors. also a priority-first sync hasn't\n            when last_sync_completed_at is null and last_error_at is null then 'initial sync in progress'\n\n            -- the last attempted sync had an error\n            when last_sync_batch_id = last_error_batch then 'broken'\n\n            -- there's never been a successful sync and there have been errors\n            when last_sync_completed_at is null and last_error_at is not null then 'broken'\n\n        else 'connected' end as connector_health\n\n    from connector_metrics\n),\n\n-- Joining with log to grab pertinent error/warning messagees\nconnector_recent_logs as (\n\n    select \n        connector_health_status.connector_id,\n        connector_health_status.connector_name,\n        connector_health_status.connector_type,\n        connector_health_status.destination_id,\n        connector_health_status.connector_health,\n        connector_health_status.last_successful_sync_completed_at,\n        connector_health_status.last_sync_started_at,\n        connector_health_status.last_sync_completed_at,\n        connector_health_status.set_up_at,\n        connector_log.event_subtype,\n        connector_log.event_type,\n        connector_log.message_data\n\n    from connector_health_status \n    left join connector_log \n        on connector_log.connector_id = connector_health_status.connector_id\n        -- limiting relevance to since the last successful sync completion (if there has been one)\n        and connector_log.created_at > coalesce(connector_health_status.last_sync_completed_at, connector_health_status.last_priority_first_sync_completed_at, '2000-01-01') \n        -- only looking at errors and warnings (excluding syncs - both normal and priority first)\n        and connector_log.event_type != 'INFO' \n        -- need to explicitly avoid priority first statuses because they are of event_type WARNING\n        and not (connector_log.event_subtype = 'status' \n            and \n\n  parse_json( connector_log.message_data )['status'] ='RESCHEDULED'\n            and \n\n  parse_json( connector_log.message_data )['reason'] like '%intended behavior%')\n\n    group by -- remove duplicates\n        connector_health_status.connector_id,\n        connector_health_status.connector_name,\n        connector_health_status.connector_type,\n        connector_health_status.destination_id,\n        connector_health_status.connector_health,\n        connector_health_status.last_successful_sync_completed_at,\n        connector_health_status.last_sync_started_at,\n        connector_health_status.last_sync_completed_at,\n        connector_health_status.set_up_at,\n        connector_log.event_subtype,\n        connector_log.event_type,\n        connector_log.message_data\n\n),\n\nfinal as (\n\n    select\n        connector_recent_logs.connector_id,\n        connector_recent_logs.connector_name,\n        connector_recent_logs.connector_type,\n        connector_recent_logs.destination_id,\n        destination.destination_name,\n        connector_recent_logs.connector_health,\n        connector_recent_logs.last_successful_sync_completed_at,\n        connector_recent_logs.last_sync_started_at,\n        connector_recent_logs.last_sync_completed_at,\n        connector_recent_logs.set_up_at,\n        coalesce(schema_changes.number_of_schema_changes_last_month, 0) as number_of_schema_changes_last_month\n        \n        \n        , \n    listagg(case when connector_recent_logs.event_type = 'SEVERE' then connector_recent_logs.message_data else null end, '\\n')\n\n as errors_since_last_completed_sync\n        , \n    listagg(case when connector_recent_logs.event_type = 'WARNING' then connector_recent_logs.message_data else null end, '\\n')\n\n as warnings_since_last_completed_sync\n        \n\n    from connector_recent_logs\n    left join schema_changes \n        on connector_recent_logs.connector_id = schema_changes.connector_id \n\n    join destination on destination.destination_id = connector_recent_logs.destination_id\n    group by \n        connector_recent_logs.connector_id, \n        connector_recent_logs.connector_name, \n        connector_recent_logs.connector_type, \n        connector_recent_logs.destination_id, \n        destination.destination_name, \n        connector_recent_logs.connector_health, \n        connector_recent_logs.last_successful_sync_completed_at, \n        connector_recent_logs.last_sync_started_at, \n        connector_recent_logs.last_sync_completed_at, \n        connector_recent_logs.set_up_at, \n        number_of_schema_changes_last_month\n)\n\nselect * from final", "relation_name": "DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.fivetran_platform__connector_status"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:31.039340Z", "completed_at": "2023-12-12T19:08:31.043914Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:31.044436Z", "completed_at": "2023-12-12T19:08:31.044440Z"}], "thread_id": "Thread-1", "execution_time": 0.006209135055541992, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.dbt_utils_unique_combination_of_columns_stg_fivetran_platform__log_log_id__created_at.c406abd91d", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        log_id, created_at\n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__log\n    group by log_id, created_at\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:31.046068Z", "completed_at": "2023-12-12T19:08:31.052140Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:31.052644Z", "completed_at": "2023-12-12T19:08:31.052648Z"}], "thread_id": "Thread-1", "execution_time": 0.007603883743286133, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.fivetran_platform__usage_mar_destination_history", "compiled": true, "compiled_code": "with table_mar as (\n    \n    select *\n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.fivetran_platform__mar_table_history\n),\n\ncredits_used as (\n\n    select *\n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__credits_used\n),\n\nuseage_cost as (\n\n    select *\n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__usage_cost\n),\n\ndestination_mar as (\n\n    select \n        cast(measured_month as date) as measured_month,\n        destination_id,\n        destination_name,\n        sum(free_monthly_active_rows) as free_monthly_active_rows,\n        sum(paid_monthly_active_rows) as paid_monthly_active_rows,\n        sum(total_monthly_active_rows) as total_monthly_active_rows\n    from table_mar\n    group by measured_month, destination_id, destination_name\n),\n\nusage as (\n\n    select \n        coalesce(credits_used.destination_id, useage_cost.destination_id) as destination_id,\n        credits_used.credits_spent,\n        useage_cost.dollars_spent,\n        cast(concat(coalesce(credits_used.measured_month,useage_cost.measured_month), '-01') as date) as measured_month -- match date format to join with MAR table\n    from credits_used\n    full outer join useage_cost\n        on useage_cost.measured_month = credits_used.measured_month\n        and useage_cost.destination_id = credits_used.destination_id\n),\n\njoin_usage_mar as (\n\n    select \n        destination_mar.measured_month,\n        destination_mar.destination_id,\n        destination_mar.destination_name,\n        usage.credits_spent,\n        usage.dollars_spent,\n        destination_mar.free_monthly_active_rows,\n        destination_mar.paid_monthly_active_rows,\n        destination_mar.total_monthly_active_rows,\n\n        -- credit and usage mar calculations\n        round( cast(nullif(usage.credits_spent,0) * 1000000.0 as numeric(28,6)) / cast(nullif(destination_mar.total_monthly_active_rows,0) as numeric(28,6)), 2) as credits_spent_per_million_mar,\n        round( cast(nullif(destination_mar.total_monthly_active_rows,0) * 1.0 as numeric(28,6)) / cast(nullif(usage.credits_spent,0) as numeric(28,6)), 0) as mar_per_credit_spent,\n        round( cast(nullif(usage.dollars_spent,0) * 1000000.0 as numeric(28,6)) / cast(nullif(destination_mar.total_monthly_active_rows,0) as numeric(28,6)), 2) as amount_spent_per_million_mar,\n        round( cast(nullif(destination_mar.total_monthly_active_rows,0) * 1.0 as numeric(28,6)) / cast(nullif(usage.dollars_spent,0) as numeric(28,6)), 0) as mar_per_amount_spent\n    from destination_mar \n    left join usage \n        on destination_mar.measured_month = cast(usage.measured_month as date)\n        and destination_mar.destination_id = usage.destination_id\n)\n\nselect * \nfrom join_usage_mar\n -- sql server doesn't support ordering CTEs\norder by measured_month desc\n", "relation_name": "DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.fivetran_platform__usage_mar_destination_history"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:31.054317Z", "completed_at": "2023-12-12T19:08:31.058350Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:31.058877Z", "completed_at": "2023-12-12T19:08:31.058881Z"}], "thread_id": "Thread-1", "execution_time": 0.005629301071166992, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.dbt_utils_unique_combination_of_columns_fivetran_platform__mar_table_history_connector_id__destination_id__schema_name__table_name__measured_month.b7babb1441", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        connector_id, destination_id, schema_name, table_name, measured_month\n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.fivetran_platform__mar_table_history\n    group by connector_id, destination_id, schema_name, table_name, measured_month\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:31.060509Z", "completed_at": "2023-12-12T19:08:31.063954Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:31.064462Z", "completed_at": "2023-12-12T19:08:31.064465Z"}], "thread_id": "Thread-1", "execution_time": 0.004993915557861328, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.dbt_utils_unique_combination_of_columns_fivetran_platform__audit_user_activity_log_id__occurred_at.be572689a3", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        log_id, occurred_at\n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.fivetran_platform__audit_user_activity\n    group by log_id, occurred_at\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:31.066082Z", "completed_at": "2023-12-12T19:08:31.569824Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:31.570586Z", "completed_at": "2023-12-12T19:08:31.570594Z"}], "thread_id": "Thread-1", "execution_time": 0.613135814666748, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.fivetran_platform__audit_table", "compiled": true, "compiled_code": "\n\nwith sync_log as (\n    \n    select \n        *,\n        \n\n  parse_json( message_data )['table'] as table_name\n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__log\n    where event_subtype in ('sync_start', 'sync_end', 'write_to_table_start', 'write_to_table_end', 'records_modified')\n\n    \n\n    -- Capture the latest timestamp in a call statement instead of a subquery for optimizing BQ costs on incremental runs-- load the result from the above query into a new variable-- the query_result is stored as a dataframe. Therefore, we want to now store it as a singular value.-- compare the new batch of data to the latest sync already stored in this model\n    and cast(created_at as date) > '2021-12-10'\n\n    \n),\n\n\nconnector as (\n\n    select *\n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.fivetran_platform__connector_status\n),\n\nadd_connector_info as (\n\n    select \n        sync_log.*,\n        connector.connector_name,\n        connector.destination_id,\n        connector.destination_name\n    from sync_log \n    left join connector\n        on connector.connector_id = sync_log.connector_id\n),\n\nsync_timestamps as (\n\n    select\n        connector_id,\n        connector_name,\n        table_name,\n        event_subtype,\n        destination_id,\n        destination_name,\n        created_at as write_to_table_start,\n        min(case when event_subtype = 'write_to_table_end' then created_at else null end) \n            over (partition by connector_id, table_name order by created_at ROWS between CURRENT ROW AND UNBOUNDED FOLLOWING) as write_to_table_end,\n\n        max(case when event_subtype = 'sync_start' then created_at else null end) \n            over (partition by connector_id order by created_at ROWS between UNBOUNDED PRECEDING and CURRENT ROW) as sync_start,\n\n        min(case when event_subtype = 'sync_end' then created_at else null end) \n            over (partition by connector_id order by created_at ROWS between CURRENT ROW AND UNBOUNDED FOLLOWING) as sync_end, -- coalesce with next_sync_start\n\n        min(case when event_subtype = 'sync_start' then created_at else null end) \n            over (partition by connector_id order by created_at ROWS between CURRENT ROW AND UNBOUNDED FOLLOWING) as next_sync_start\n    from add_connector_info\n),\n\n-- this will be the base for every record in the final CTE\nlimit_to_table_starts as (\n\n    select *\n    from sync_timestamps \n    where event_subtype = 'write_to_table_start'\n),\n\nrecords_modified_log as (\n\n    select \n        connector_id,\n        created_at,\n        \n\n  parse_json( message_data )['table'] as table_name,\n        \n\n  parse_json( message_data )['schema'] as schema_name,\n        \n\n  parse_json( message_data )['operationType'] as operation_type,\n        cast (\n\n  parse_json( message_data )['count'] as integer) as row_count\n    from sync_log \n    where event_subtype = 'records_modified'\n\n),\n\nsum_records_modified as (\n\n    select\n        limit_to_table_starts.connector_id,\n        limit_to_table_starts.connector_name,\n        coalesce(records_modified_log.schema_name, limit_to_table_starts.connector_name) as schema_name,\n        limit_to_table_starts.table_name,\n        limit_to_table_starts.destination_id,\n        limit_to_table_starts.destination_name,\n        limit_to_table_starts.write_to_table_start,\n        limit_to_table_starts.write_to_table_end,\n        limit_to_table_starts.sync_start,\n        case when limit_to_table_starts.sync_end > limit_to_table_starts.next_sync_start then null else limit_to_table_starts.sync_end end as sync_end,\n        sum(case when records_modified_log.operation_type = 'REPLACED_OR_INSERTED' then records_modified_log.row_count else 0 end) as sum_rows_replaced_or_inserted,\n        sum(case when records_modified_log.operation_type = 'UPDATED' then records_modified_log.row_count else 0 end) as sum_rows_updated,\n        sum(case when records_modified_log.operation_type = 'DELETED' then records_modified_log.row_count else 0 end) as sum_rows_deleted\n    from limit_to_table_starts\n    left join records_modified_log on \n        limit_to_table_starts.connector_id = records_modified_log.connector_id\n        and limit_to_table_starts.table_name = records_modified_log.table_name\n\n        -- confine it to one sync\n        and records_modified_log.created_at > limit_to_table_starts.sync_start \n        and records_modified_log.created_at < coalesce(limit_to_table_starts.sync_end, limit_to_table_starts.next_sync_start) \n\n    group by \n        limit_to_table_starts.connector_id,\n        limit_to_table_starts.connector_name,\n        coalesce(records_modified_log.schema_name, limit_to_table_starts.connector_name),\n        limit_to_table_starts.table_name,\n        limit_to_table_starts.destination_id,\n        limit_to_table_starts.destination_name,\n        limit_to_table_starts.write_to_table_start,\n        limit_to_table_starts.write_to_table_end,\n        limit_to_table_starts.sync_start,\n        case when limit_to_table_starts.sync_end > limit_to_table_starts.next_sync_start then null else limit_to_table_starts.sync_end end\n),\n\nfinal as (\n\n    select \n        *,\n        md5(cast(coalesce(cast(schema_name as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(connector_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(destination_id as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(table_name as TEXT), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(write_to_table_start as TEXT), '_dbt_utils_surrogate_key_null_') as TEXT)) as unique_table_sync_key, -- for incremental materialization \n        date_trunc('day', sync_start) as sync_start_day -- for partitioning in databricks\n    from sum_records_modified\n)\n\nselect *\nfrom final", "relation_name": "DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.fivetran_platform__audit_table"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:31.681914Z", "completed_at": "2023-12-12T19:08:32.711767Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:32.712553Z", "completed_at": "2023-12-12T19:08:32.712562Z"}], "thread_id": "Thread-1", "execution_time": 1.146045207977295, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.fivetran_platform__connector_daily_events", "compiled": true, "compiled_code": "-- depends_on: DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1.connector\n\nwith connector as (\n    \n    select * \n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.fivetran_platform__connector_status\n),\n\n-- grab api calls, schema changes, and record modifications\nlog_events as (\n\n    select \n        connector_id,\n        cast( date_trunc('day', created_at) as date) as date_day,\n        case \n            when event_subtype in ('create_table', 'alter_table', 'create_schema', 'change_schema_config') then 'schema_change' \n            else event_subtype end as event_subtype,\n\n        sum(case when event_subtype = 'records_modified' then cast( \n\n  parse_json( message_data )['count'] as integer )\n        else 1 end) as count_events \n\n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__log\n\n    where event_subtype in ('api_call', \n                            'records_modified', \n                            'create_table', 'alter_table', 'create_schema', 'change_schema_config') -- all schema changes\n                            \n        and connector_id is not null\n\n    group by connector_id, cast( date_trunc('day', created_at) as date), event_subtype\n),\n\npivot_out_events as (\n\n    select\n        connector_id,\n        date_day,\n        max(case when event_subtype = 'api_call' then count_events else 0 end) as count_api_calls,\n        max(case when event_subtype = 'records_modified' then count_events else 0 end) as count_record_modifications,\n        max(case when event_subtype = 'schema_change' then count_events else 0 end) as count_schema_changes\n\n    from log_events\n    group by connector_id, date_day\n), \n\nconnector_event_counts as (\n\n    select\n        pivot_out_events.date_day,\n        pivot_out_events.count_api_calls,\n        pivot_out_events.count_record_modifications,\n        pivot_out_events.count_schema_changes,\n        connector.connector_name,\n        connector.connector_id,\n        connector.connector_type,\n        connector.destination_name,\n        connector.destination_id,\n        connector.set_up_at\n    from\n    connector left join pivot_out_events \n        on pivot_out_events.connector_id = connector.connector_id\n),\n\nspine as (\n\n    \n    \n    \n    \n    \n\n    select cast(date_day as date) as date_day\n    from (\n        \n\n    \n\n\n\n\n\nwith rawdata as (\n\n    \n\n    \n\n    with p as (\n        select 0 as generated_number union all select 1\n    ), unioned as (\n\n    select\n\n    \n    p0.generated_number * power(2, 0)\n     + \n    \n    p1.generated_number * power(2, 1)\n     + \n    \n    p2.generated_number * power(2, 2)\n     + \n    \n    p3.generated_number * power(2, 3)\n     + \n    \n    p4.generated_number * power(2, 4)\n     + \n    \n    p5.generated_number * power(2, 5)\n     + \n    \n    p6.generated_number * power(2, 6)\n     + \n    \n    p7.generated_number * power(2, 7)\n     + \n    \n    p8.generated_number * power(2, 8)\n     + \n    \n    p9.generated_number * power(2, 9)\n     + \n    \n    p10.generated_number * power(2, 10)\n    \n    \n    + 1\n    as generated_number\n\n    from\n\n    \n    p as p0\n     cross join \n    \n    p as p1\n     cross join \n    \n    p as p2\n     cross join \n    \n    p as p3\n     cross join \n    \n    p as p4\n     cross join \n    \n    p as p5\n     cross join \n    \n    p as p6\n     cross join \n    \n    p as p7\n     cross join \n    \n    p as p8\n     cross join \n    \n    p as p9\n     cross join \n    \n    p as p10\n    \n    \n\n    )\n\n    select *\n    from unioned\n    where generated_number <= 1733\n    order by generated_number\n\n\n\n),\n\nall_periods as (\n\n    select (\n        \n\n    dateadd(\n        day,\n        row_number() over (order by 1) - 1,\n        cast('2019-03-22' as date)\n        )\n\n\n    ) as date_day\n    from rawdata\n\n),\n\nfiltered as (\n\n    select *\n    from all_periods\n    where date_day <= \n\n    dateadd(\n        week,\n        1,\n        date_trunc('day', \n  current_timestamp::timestamp\n)\n        )\n\n\n\n)\n\nselect * from filtered\n\n\n        \n \n    ) as date_spine\n),\n\nconnector_event_history as (\n\n    select\n        spine.date_day,\n        connector_event_counts.connector_name,\n        connector_event_counts.connector_id,\n        connector_event_counts.connector_type,\n        connector_event_counts.destination_name,\n        connector_event_counts.destination_id,\n        max(case \n            when spine.date_day = connector_event_counts.date_day then connector_event_counts.count_api_calls\n            else 0\n        end) as count_api_calls,\n        max(case \n            when spine.date_day = connector_event_counts.date_day then connector_event_counts.count_record_modifications\n            else 0\n        end) as count_record_modifications,\n        max(case \n            when spine.date_day = connector_event_counts.date_day then connector_event_counts.count_schema_changes\n            else 0\n        end) as count_schema_changes\n    from\n    spine join connector_event_counts\n        on spine.date_day  >= cast(date_trunc('day', cast(connector_event_counts.set_up_at as date)) as date)\n\n    group by spine.date_day, connector_name, connector_id, connector_type, destination_name, destination_id\n),\n\n-- now rejoin spine to get a complete calendar\njoin_event_history as (\n    \n    select\n        spine.date_day,\n        connector_event_history.connector_name,\n        connector_event_history.connector_id,\n        connector_event_history.connector_type,\n        connector_event_history.destination_name,\n        connector_event_history.destination_id,\n        max(connector_event_history.count_api_calls) as count_api_calls,\n        max(connector_event_history.count_record_modifications) as count_record_modifications,\n        max(connector_event_history.count_schema_changes) as count_schema_changes\n\n    from\n    spine left join connector_event_history\n        on spine.date_day = connector_event_history.date_day\n\n    group by spine.date_day, connector_name, connector_id, connector_type, destination_name, destination_id\n),\n\nfinal as (\n\n    select *\n    from join_event_history\n\n    where date_day <= cast(\n  current_timestamp::timestamp\n as date)\n\n     -- sql server cant order CTEs\n    order by date_day desc\n    \n)\n\nselect *\nfrom final", "relation_name": "DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.fivetran_platform__connector_daily_events"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:32.830750Z", "completed_at": "2023-12-12T19:08:32.841876Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:32.842997Z", "completed_at": "2023-12-12T19:08:32.843007Z"}], "thread_id": "Thread-1", "execution_time": 0.01489114761352539, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.fivetran_platform__schema_changelog", "compiled": true, "compiled_code": "with schema_changes as (\n\n    select *\n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.stg_fivetran_platform__log\n\n    where event_subtype in ('create_table', 'alter_table', 'create_schema', 'change_schema_config')\n),\n\nconnector as (\n\n    select *\n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.fivetran_platform__connector_status\n),\n\nadd_connector_info as (\n\n    select \n        schema_changes.*,\n        connector.connector_name,\n        connector.destination_id,\n        connector.destination_name\n\n    from schema_changes join connector \n        on schema_changes.connector_id = connector.connector_id\n),\n\nfinal as (\n\n    select\n        connector_id,\n        connector_name,\n        destination_id,\n        destination_name,\n        created_at,\n        event_subtype,\n        message_data,\n\n        case \n        when event_subtype = 'alter_table' then \n\n  parse_json( message_data )['table'] \n        when event_subtype = 'create_table' then \n\n  parse_json( message_data )['name'] \n        else null end as table_name,\n\n        case \n        when event_subtype = 'create_schema' or event_subtype = 'create_table' then \n\n  parse_json( message_data )['schema'] \n        else null end as schema_name\n    \n    from add_connector_info\n)\n\nselect * from final\n\norder by created_at desc, connector_id\n", "relation_name": "DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.fivetran_platform__schema_changelog"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:32.846299Z", "completed_at": "2023-12-12T19:08:32.852753Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:32.853624Z", "completed_at": "2023-12-12T19:08:32.853632Z"}], "thread_id": "Thread-1", "execution_time": 0.00932002067565918, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.dbt_utils_unique_combination_of_columns_fivetran_platform__connector_status_connector_id__destination_id.1d83a6dd89", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        connector_id, destination_id\n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.fivetran_platform__connector_status\n    group by connector_id, destination_id\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:32.856304Z", "completed_at": "2023-12-12T19:08:32.860984Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:32.861731Z", "completed_at": "2023-12-12T19:08:32.861736Z"}], "thread_id": "Thread-1", "execution_time": 0.007028341293334961, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.dbt_utils_unique_combination_of_columns_fivetran_platform__usage_mar_destination_history_destination_id__measured_month.05f6419efd", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        destination_id, measured_month\n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.fivetran_platform__usage_mar_destination_history\n    group by destination_id, measured_month\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:32.864088Z", "completed_at": "2023-12-12T19:08:32.868334Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:32.868984Z", "completed_at": "2023-12-12T19:08:32.868989Z"}], "thread_id": "Thread-1", "execution_time": 0.006339073181152344, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.not_null_fivetran_platform__audit_table_unique_table_sync_key.d6c37e48af", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect unique_table_sync_key\nfrom DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.fivetran_platform__audit_table\nwhere unique_table_sync_key is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:32.871083Z", "completed_at": "2023-12-12T19:08:32.875008Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:32.875652Z", "completed_at": "2023-12-12T19:08:32.875657Z"}], "thread_id": "Thread-1", "execution_time": 0.005892753601074219, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.unique_fivetran_platform__audit_table_unique_table_sync_key.308ad058f7", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    unique_table_sync_key as unique_field,\n    count(*) as n_records\n\nfrom DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.fivetran_platform__audit_table\nwhere unique_table_sync_key is not null\ngroup by unique_table_sync_key\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:32.877634Z", "completed_at": "2023-12-12T19:08:32.882772Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:32.883389Z", "completed_at": "2023-12-12T19:08:32.883393Z"}], "thread_id": "Thread-1", "execution_time": 0.00697779655456543, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.dbt_utils_unique_combination_of_columns_fivetran_platform__connector_daily_events_connector_id__destination_id__date_day.a279340e8f", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        connector_id, destination_id, date_day\n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.fivetran_platform__connector_daily_events\n    group by connector_id, destination_id, date_day\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-12-12T19:08:32.885322Z", "completed_at": "2023-12-12T19:08:32.889225Z"}, {"name": "execute", "started_at": "2023-12-12T19:08:32.889780Z", "completed_at": "2023-12-12T19:08:32.889784Z"}], "thread_id": "Thread-1", "execution_time": 0.005650997161865234, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.dbt_utils_unique_combination_of_columns_fivetran_platform__schema_changelog_connector_id__destination_id__message_data__created_at.cc39f64493", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        connector_id, destination_id, message_data, created_at\n    from DBT_PACKAGE_TESTING.fivetran_platform_integration_tests_1_fivetran_platform.fivetran_platform__schema_changelog\n    group by connector_id, destination_id, message_data, created_at\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}], "elapsed_time": 4.609646797180176, "args": {"use_colors_file": true, "defer": false, "indirect_selection": "eager", "partial_parse_file_diff": true, "log_format_file": "debug", "empty_catalog": false, "strict_mode": false, "log_path": "/Users/jamie.rodriguez/Desktop/dbt_repos/Fivetran_platform/dbt_fivetran_log/integration_tests/logs", "log_format": "default", "macro_debugging": false, "enable_legacy_logger": false, "introspect": true, "project_dir": "/Users/jamie.rodriguez/Desktop/dbt_repos/Fivetran_platform/dbt_fivetran_log/integration_tests", "vars": {}, "write_json": true, "static_parser": true, "use_colors": true, "warn_error_options": {"include": [], "exclude": []}, "exclude": [], "printer_width": 80, "print": true, "log_level_file": "debug", "log_file_max_bytes": 10485760, "invocation_command": "dbt docs generate", "version_check": true, "log_level": "info", "populate_cache": true, "cache_selected_only": false, "quiet": false, "compile": true, "select": [], "profiles_dir": "/Users/jamie.rodriguez/.dbt", "show_resource_report": false, "favor_state": false, "static": false, "partial_parse": true, "which": "generate", "send_anonymous_usage_stats": true}}