{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v5.json", "dbt_version": "1.7.0", "generated_at": "2023-11-14T18:04:15.822113Z", "invocation_id": "5e424184-132f-49e4-8bc7-f99dbda88d2d", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:12.525694Z", "completed_at": "2023-11-14T18:04:12.562538Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:12.564647Z", "completed_at": "2023-11-14T18:04:12.564670Z"}], "thread_id": "Thread-1", "execution_time": 0.0462799072265625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.stg_fivetran_platform__account", "compiled": true, "compiled_code": "with base as (\n    \n    select * \n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1`.`account`\n),\n\nfields as (\n\n    select\n        id as account_id,\n        country,\n        cast(created_at as timestamp) as created_at,\n        name as account_name,\n        status\n    from base\n)\n\nselect * \nfrom fields", "relation_name": "`dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__account`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:12.540819Z", "completed_at": "2023-11-14T18:04:12.562970Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:12.564993Z", "completed_at": "2023-11-14T18:04:12.564997Z"}], "thread_id": "Thread-2", "execution_time": 0.045790910720825195, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.stg_fivetran_platform__connector_tmp", "compiled": true, "compiled_code": "select *\nfrom `dbt-package-testing`.`fivetran_platform_integration_tests_1`.`connector`", "relation_name": "`dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__connector_tmp`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:12.546807Z", "completed_at": "2023-11-14T18:04:12.563991Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:12.567167Z", "completed_at": "2023-11-14T18:04:12.567171Z"}], "thread_id": "Thread-4", "execution_time": 0.04585599899291992, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.stg_fivetran_platform__destination", "compiled": true, "compiled_code": "with base as (\n\n    select * \n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1`.`destination`\n),\n\nfields as (\n\n    select\n        id as destination_id,\n        account_id,\n        cast(created_at as timestamp) as created_at,\n        name as destination_name,\n        region\n    from base\n)\n\nselect * \nfrom fields", "relation_name": "`dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__destination`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:12.544875Z", "completed_at": "2023-11-14T18:04:12.564315Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:12.567493Z", "completed_at": "2023-11-14T18:04:12.567498Z"}], "thread_id": "Thread-3", "execution_time": 0.04742789268493652, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.stg_fivetran_platform__credits_used", "compiled": true, "compiled_code": "\n\nwith base as (\n\n    select * \n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1`.`credits_used`\n),\n\nfields as (\n    \n    select \n        destination_id,\n        measured_month,\n        credits_consumed as credits_spent\n    from base\n)\n\nselect * \nfrom fields\n\n", "relation_name": "`dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__credits_used`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:12.576699Z", "completed_at": "2023-11-14T18:04:12.586249Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:12.587841Z", "completed_at": "2023-11-14T18:04:12.587846Z"}], "thread_id": "Thread-2", "execution_time": 0.018970727920532227, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.stg_fivetran_platform__incremental_mar", "compiled": true, "compiled_code": "with base as (\n\n    select * \n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1`.`incremental_mar`\n),\n\nfields as (\n\n    select\n        connector_id as connector_name,\n        destination_id,\n        free_type,\n        cast(measured_date as timestamp) as measured_date,\n        schema_name,\n        sync_type,\n        table_name,\n        updated_at,\n        _fivetran_synced,\n        incremental_rows\n    from base\n)\n\nselect * \nfrom fields", "relation_name": "`dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__incremental_mar`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:12.572504Z", "completed_at": "2023-11-14T18:04:12.586510Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:12.588136Z", "completed_at": "2023-11-14T18:04:12.588139Z"}], "thread_id": "Thread-1", "execution_time": 0.01988506317138672, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.stg_fivetran_platform__destination_membership", "compiled": true, "compiled_code": "\n\nwith base as (\n    \n    select * from `dbt-package-testing`.`fivetran_platform_integration_tests_1`.`destination_membership`\n),\n\nfields as (\n\n    select\n        destination_id,\n        user_id,\n        cast(activated_at as timestamp) as activated_at,\n        cast(joined_at as timestamp) as joined_at,\n        role as destination_role\n    from base\n)\n\nselect * \nfrom fields", "relation_name": "`dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__destination_membership`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:12.580311Z", "completed_at": "2023-11-14T18:04:12.587347Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:12.589890Z", "completed_at": "2023-11-14T18:04:12.589894Z"}], "thread_id": "Thread-4", "execution_time": 0.01954483985900879, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.stg_fivetran_platform__log_tmp", "compiled": true, "compiled_code": "select *\nfrom `dbt-package-testing`.`fivetran_platform_integration_tests_1`.`log`", "relation_name": "`dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__log_tmp`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:12.582861Z", "completed_at": "2023-11-14T18:04:12.587582Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:12.590155Z", "completed_at": "2023-11-14T18:04:12.590158Z"}], "thread_id": "Thread-3", "execution_time": 0.0196378231048584, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.stg_fivetran_platform__usage_cost", "compiled": true, "compiled_code": "\nwith base as (\n\n    select * \n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1`.`usage_cost`\n),\n\nfields as (\n    \n    select \n        destination_id,\n        measured_month,\n        amount as dollars_spent\n    from base\n)\n\nselect * \nfrom fields\n\n", "relation_name": "`dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__usage_cost`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:12.598737Z", "completed_at": "2023-11-14T18:04:12.599968Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:12.603966Z", "completed_at": "2023-11-14T18:04:12.603971Z"}], "thread_id": "Thread-1", "execution_time": 0.012684106826782227, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.fivetran_log_integration_tests.account", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:12.601010Z", "completed_at": "2023-11-14T18:04:12.602202Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:12.605660Z", "completed_at": "2023-11-14T18:04:12.605664Z"}], "thread_id": "Thread-4", "execution_time": 0.012965917587280273, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.fivetran_log_integration_tests.connector", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:12.602519Z", "completed_at": "2023-11-14T18:04:12.603662Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:12.605938Z", "completed_at": "2023-11-14T18:04:12.605940Z"}], "thread_id": "Thread-3", "execution_time": 0.013061046600341797, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.fivetran_log_integration_tests.credits_used", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:12.594747Z", "completed_at": "2023-11-14T18:04:12.604221Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:12.606487Z", "completed_at": "2023-11-14T18:04:12.606489Z"}], "thread_id": "Thread-2", "execution_time": 0.0162808895111084, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.stg_fivetran_platform__user", "compiled": true, "compiled_code": "\n\nwith base as (\n\n    select * \n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1`.`user`\n),\n\nfields as (\n\n    select\n        id as user_id,\n        cast(created_at as timestamp) as created_at,\n        email,\n        email_disabled as has_disabled_email_notifications,\n        family_name as last_name,\n        given_name as first_name,\n        phone,\n        verified as is_verified\n    from base\n)\n\nselect * \nfrom fields", "relation_name": "`dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__user`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:12.610611Z", "completed_at": "2023-11-14T18:04:12.612450Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:12.617126Z", "completed_at": "2023-11-14T18:04:12.617131Z"}], "thread_id": "Thread-1", "execution_time": 0.011912107467651367, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.fivetran_log_integration_tests.destination", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:12.614028Z", "completed_at": "2023-11-14T18:04:12.615235Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:12.620206Z", "completed_at": "2023-11-14T18:04:12.620209Z"}], "thread_id": "Thread-4", "execution_time": 0.011639833450317383, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.fivetran_log_integration_tests.destination_membership", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:12.615571Z", "completed_at": "2023-11-14T18:04:12.616791Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:12.620472Z", "completed_at": "2023-11-14T18:04:12.620475Z"}], "thread_id": "Thread-3", "execution_time": 0.011792898178100586, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.fivetran_log_integration_tests.incremental_mar", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:12.617401Z", "completed_at": "2023-11-14T18:04:12.618694Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:12.620996Z", "completed_at": "2023-11-14T18:04:12.620998Z"}], "thread_id": "Thread-2", "execution_time": 0.010170936584472656, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.fivetran_log_integration_tests.log", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:12.625072Z", "completed_at": "2023-11-14T18:04:12.626390Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:12.637763Z", "completed_at": "2023-11-14T18:04:12.637768Z"}], "thread_id": "Thread-1", "execution_time": 0.020350933074951172, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.fivetran_log_integration_tests.usage_cost", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:12.628014Z", "completed_at": "2023-11-14T18:04:12.629916Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:12.643138Z", "completed_at": "2023-11-14T18:04:12.643142Z"}], "thread_id": "Thread-4", "execution_time": 0.020157814025878906, "adapter_response": {}, "message": null, "failures": null, "unique_id": "seed.fivetran_log_integration_tests.user", "compiled": null, "compiled_code": null, "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:12.630192Z", "completed_at": "2023-11-14T18:04:12.643435Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:12.646040Z", "completed_at": "2023-11-14T18:04:12.646044Z"}], "thread_id": "Thread-3", "execution_time": 0.022794008255004883, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.not_null_stg_fivetran_platform__account_account_id.d09ebf1a1e", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect account_id\nfrom `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__account`\nwhere account_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:12.638046Z", "completed_at": "2023-11-14T18:04:12.643951Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:12.646614Z", "completed_at": "2023-11-14T18:04:12.646617Z"}], "thread_id": "Thread-2", "execution_time": 0.024075031280517578, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.unique_stg_fivetran_platform__account_account_id.114e181adc", "compiled": true, "compiled_code": "\n    \n    \n\nwith dbt_test__target as (\n\n  select account_id as unique_field\n  from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__account`\n  where account_id is not null\n\n)\n\nselect\n    unique_field,\n    count(*) as n_records\n\nfrom dbt_test__target\ngroup by unique_field\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:12.652568Z", "completed_at": "2023-11-14T18:04:12.660806Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:12.667874Z", "completed_at": "2023-11-14T18:04:12.667879Z"}], "thread_id": "Thread-4", "execution_time": 0.021780967712402344, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.not_null_stg_fivetran_platform__destination_destination_id.0cdbe6b780", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect destination_id\nfrom `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__destination`\nwhere destination_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:12.657845Z", "completed_at": "2023-11-14T18:04:12.668167Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:12.670072Z", "completed_at": "2023-11-14T18:04:12.670075Z"}], "thread_id": "Thread-3", "execution_time": 0.014747858047485352, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.unique_stg_fivetran_platform__destination_destination_id.582a1280ed", "compiled": true, "compiled_code": "\n    \n    \n\nwith dbt_test__target as (\n\n  select destination_id as unique_field\n  from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__destination`\n  where destination_id is not null\n\n)\n\nselect\n    unique_field,\n    count(*) as n_records\n\nfrom dbt_test__target\ngroup by unique_field\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:12.661086Z", "completed_at": "2023-11-14T18:04:12.669007Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:12.670736Z", "completed_at": "2023-11-14T18:04:12.670739Z"}], "thread_id": "Thread-2", "execution_time": 0.015115737915039062, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.dbt_utils_unique_combination_of_columns_stg_fivetran_platform__credits_used_measured_month__destination_id.bea8f20c38", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        measured_month, destination_id\n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__credits_used`\n    group by measured_month, destination_id\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:12.672629Z", "completed_at": "2023-11-14T18:04:12.677939Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:12.730499Z", "completed_at": "2023-11-14T18:04:12.730506Z"}], "thread_id": "Thread-4", "execution_time": 0.060685157775878906, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.dbt_utils_unique_combination_of_columns_stg_fivetran_platform__destination_membership_destination_id__user_id.82ac27c35a", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        destination_id, user_id\n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__destination_membership`\n    group by destination_id, user_id\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:12.681007Z", "completed_at": "2023-11-14T18:04:12.735912Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:12.736712Z", "completed_at": "2023-11-14T18:04:12.736717Z"}], "thread_id": "Thread-2", "execution_time": 0.06028270721435547, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.dbt_utils_unique_combination_of_columns_stg_fivetran_platform__usage_cost_measured_month__destination_id.d6d997525f", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        measured_month, destination_id\n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__usage_cost`\n    group by measured_month, destination_id\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:12.732645Z", "completed_at": "2023-11-14T18:04:12.737914Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:12.739175Z", "completed_at": "2023-11-14T18:04:12.739179Z"}], "thread_id": "Thread-4", "execution_time": 0.010925054550170898, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.not_null_stg_fivetran_platform__user_user_id.eb17e92ff0", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect user_id\nfrom `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__user`\nwhere user_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:12.739454Z", "completed_at": "2023-11-14T18:04:12.743062Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:12.743567Z", "completed_at": "2023-11-14T18:04:12.743570Z"}], "thread_id": "Thread-2", "execution_time": 0.005714893341064453, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.unique_stg_fivetran_platform__user_user_id.86a1a3afb9", "compiled": true, "compiled_code": "\n    \n    \n\nwith dbt_test__target as (\n\n  select user_id as unique_field\n  from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__user`\n  where user_id is not null\n\n)\n\nselect\n    unique_field,\n    count(*) as n_records\n\nfrom dbt_test__target\ngroup by unique_field\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:12.647810Z", "completed_at": "2023-11-14T18:04:13.063701Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:13.066121Z", "completed_at": "2023-11-14T18:04:13.066131Z"}], "thread_id": "Thread-1", "execution_time": 0.42267513275146484, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.stg_fivetran_platform__connector", "compiled": true, "compiled_code": "with base as (\n\n    select * \n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__connector_tmp`\n),\n\nfields as (\n    select\n        \n    cast(null as boolean) as \n    \n    _fivetran_deleted\n    \n , \n    \n    \n    _fivetran_synced\n    \n as \n    \n    _fivetran_synced\n    \n, \n    \n    \n    connecting_user_id\n    \n as \n    \n    connecting_user_id\n    \n, \n    \n    \n    connector_id\n    \n as \n    \n    connector_id\n    \n, \n    \n    \n    connector_name\n    \n as \n    \n    connector_name\n    \n, \n    \n    \n    connector_type\n    \n as \n    \n    connector_type\n    \n, \n    cast(null as string) as \n    \n    connector_type_id\n    \n , \n    \n    \n    destination_id\n    \n as \n    \n    destination_id\n    \n, \n    \n    \n    paused\n    \n as \n    \n    paused\n    \n, \n    cast(null as INT64) as \n    \n    service_version\n    \n , \n    \n    \n    signed_up\n    \n as \n    \n    signed_up\n    \n\n\n\n        ,row_number() over ( partition by connector_name, destination_id order by _fivetran_synced desc ) as nth_last_record\n    from base\n),\n\nfinal as (\n\n    select \n        connector_id,\n        connector_name,\n        coalesce(connector_type_id, connector_type) as connector_type,\n        destination_id,\n        connecting_user_id,\n        paused as is_paused,\n        signed_up as set_up_at\n    from fields\n\n    -- Only look at the most recent one\n    where nth_last_record = 1\n)\n\nselect * \nfrom final", "relation_name": "`dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__connector`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:12.678211Z", "completed_at": "2023-11-14T18:04:13.064430Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:13.066721Z", "completed_at": "2023-11-14T18:04:13.066727Z"}], "thread_id": "Thread-3", "execution_time": 0.39223575592041016, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.stg_fivetran_platform__log", "compiled": true, "compiled_code": "with base as (\n\n    select * \n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__log_tmp`\n),\n\nfields as (\n    select\n        \n    \n    \n    _fivetran_synced\n    \n as \n    \n    _fivetran_synced\n    \n, \n    \n    \n    connector_id\n    \n as \n    \n    connector_id\n    \n, \n    \n    \n    event\n    \n as \n    \n    event\n    \n, \n    \n    \n    id\n    \n as \n    \n    id\n    \n, \n    \n    \n    message_data\n    \n as \n    \n    message_data\n    \n, \n    \n    \n    message_event\n    \n as \n    \n    message_event\n    \n, \n    \n    \n    sync_id\n    \n as \n    \n    sync_id\n    \n, \n    \n    \n    time_stamp\n    \n as \n    \n    time_stamp\n    \n, \n    \n    \n    transformation_id\n    \n as \n    \n    transformation_id\n    \n\n\n\n    from base\n),\n\nfinal as (\n\n    select\n        id as log_id, \n        sync_id,\n        cast(time_stamp as timestamp) as created_at,\n        connector_id, -- Note: the connector_id column used to erroneously equal the connector_name, NOT its id.\n        case when transformation_id is not null and event is null then 'TRANSFORMATION'\n        else event end as event_type, \n        message_data,\n        case \n        when transformation_id is not null and message_data like '%has succeeded%' then 'transformation run success'\n        when transformation_id is not null and message_data like '%has failed%' then 'transformation run failed'\n        else message_event end as event_subtype,\n        transformation_id\n    from fields\n)\n\nselect * \nfrom final", "relation_name": "`dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__log`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:13.083497Z", "completed_at": "2023-11-14T18:04:13.127976Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:13.130017Z", "completed_at": "2023-11-14T18:04:13.130022Z"}], "thread_id": "Thread-2", "execution_time": 0.05874514579772949, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.dbt_utils_unique_combination_of_columns_stg_fivetran_platform__connector_connector_name__destination_id.38a4da659a", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        connector_name, destination_id\n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__connector`\n    group by connector_name, destination_id\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:13.097523Z", "completed_at": "2023-11-14T18:04:13.128325Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:13.130563Z", "completed_at": "2023-11-14T18:04:13.130566Z"}], "thread_id": "Thread-1", "execution_time": 0.05878019332885742, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.fivetran_platform__audit_user_activity", "compiled": true, "compiled_code": "with logs as (\n\n    select \n        *,\n        \n\n \n  json_extract_scalar(message_data, '$.actor')\n\n as actor_email\n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__log`\n),\n\nuser_logs as (\n\n    select *\n    from logs\n    where actor_email is not null \n        and lower(actor_email) != 'fivetran'\n),\n\nconnector as (\n\n    select *\n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__connector`\n),\n\ndestination as (\n\n    select *\n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__destination`\n),\nusers as (\n\n    select *\n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__user`\n),\n    destination_membership as (\n\n        select *\n        from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__destination_membership`\n    ),\n    final as (\n\n    select\n        timestamp_trunc(\n        cast(user_logs.created_at as timestamp),\n        day\n    ) as date_day,\n        format_date('%a', cast(user_logs.created_at as date)) as day_name,\n        extract(day from user_logs.created_at) as day_of_month,\n        user_logs.created_at as occurred_at,\n        destination.destination_name,\n        destination.destination_id,\n        connector.connector_name,\n        connector.connector_id,\n        user_logs.actor_email as email,\n        users.first_name,\n        users.last_name,\n        users.user_id,\n        destination_membership.destination_role,\n    user_logs.event_type, -- should always be INFO for user-triggered actions but include just in case\n        user_logs.event_subtype,\n        user_logs.message_data,\n        user_logs.log_id\n\n    from user_logs\n    left join connector\n        on user_logs.connector_id = connector.connector_id\n    left join destination\n        on connector.destination_id = destination.destination_id\n    left join users \n        on lower(users.email) = lower(user_logs.actor_email)\n    left join destination_membership\n        on destination.destination_id = destination_membership.destination_id\n        and users.user_id = destination_membership.user_id\n\n    )\n\nselect *\nfrom final", "relation_name": "`dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`fivetran_platform__audit_user_activity`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:13.076363Z", "completed_at": "2023-11-14T18:04:13.128633Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:13.130855Z", "completed_at": "2023-11-14T18:04:13.130859Z"}], "thread_id": "Thread-4", "execution_time": 0.06137490272521973, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.fivetran_platform__mar_table_history", "compiled": true, "compiled_code": "with incremental_mar as (\n\n    select\n        *,\n        timestamp_trunc(\n        cast(measured_date as timestamp),\n        month\n    ) as measured_month\n\n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__incremental_mar`\n),\n\nconnector as (\n\n    select *\n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__connector`\n),\n\ndestination as (\n\n    select *\n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__destination`\n),\n\nordered_mar as (\n\n    select\n        connector_name,\n        schema_name,\n        table_name,\n        destination_id,\n        measured_month,\n        max(measured_date) as last_measured_at,\n        sum(incremental_rows) as incremental_rows,\n        sum(coalesce(case when lower(free_type) = 'paid'\n            then incremental_rows\n        end, 0)) as paid_monthly_active_rows,\n        sum(coalesce(case when lower(free_type) != 'paid'\n            then incremental_rows\n        end, 0)) as free_monthly_active_rows\n\n    from incremental_mar\n    group by 1,2,3,4,5\n),\n\nlatest_mar as (\n    select \n        connector_name,\n        schema_name,\n        table_name,\n        destination_id,\n        measured_month,\n        date(last_measured_at) as last_measured_at,\n        free_monthly_active_rows,\n        paid_monthly_active_rows,\n        (free_monthly_active_rows + paid_monthly_active_rows) as total_monthly_active_rows\n\n    from ordered_mar\n),\n\nmar_join as (\n\n    select\n        latest_mar.*,\n        connector.connector_type,\n        connector.connector_id,\n        destination.destination_name\n\n    from latest_mar\n    join connector\n        on latest_mar.connector_name = connector.connector_name\n        and latest_mar.destination_id = connector.destination_id\n    join destination on latest_mar.destination_id = destination.destination_id\n)\n\nselect * from mar_join\norder by measured_month desc, destination_id, connector_name", "relation_name": "`dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`fivetran_platform__mar_table_history`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:13.111672Z", "completed_at": "2023-11-14T18:04:13.129183Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:13.131716Z", "completed_at": "2023-11-14T18:04:13.131718Z"}], "thread_id": "Thread-3", "execution_time": 0.05894589424133301, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.fivetran_platform__connector_status", "compiled": true, "compiled_code": "with transformation_removal as (\n\n    select *\n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__log`\n    where transformation_id is null\n\n),\n\nconnector_log as (\n    select \n        *,\n        sum( case when event_subtype in ('sync_start') then 1 else 0 end) over ( partition by connector_id \n            order by created_at rows unbounded preceding) as sync_batch_id\n    from transformation_removal\n    -- only looking at errors, warnings, and syncs here\n    where event_type = 'SEVERE'\n        or event_type = 'WARNING'\n        or event_subtype like 'sync%'\n        or (event_subtype = 'status' \n            and \n\n \n  json_extract_scalar(message_data, '$.status')\n\n = 'RESCHEDULED'\n            \n            and \n\n \n  json_extract_scalar(message_data, '$.reason')\n\n like '%intended behavior%'\n            ) -- for priority-first syncs. these should be captured by event_type = 'WARNING' but let's make sure\n        or (event_subtype = 'status' \n            and \n\n \n  json_extract_scalar(message_data, '$.status')\n\n = 'SUCCESSFUL'\n        )\n        -- whole reason is \"We have rescheduled the connector to force flush data from the forward sync into your destination. This is intended behavior and means that the connector is working as expected.\"\n),\n\nschema_changes as (\n\n    select\n        connector_id,\n        count(*) as number_of_schema_changes_last_month\n\n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__log`\n\n    where \n        \n\n    datetime_diff(\n        cast(current_timestamp as datetime),\n        cast(created_at as datetime),\n        day\n    )\n\n   <= 30\n        and event_subtype in ('create_table', 'alter_table', 'create_schema', 'change_schema_config')\n\n    group by 1\n\n),\n\nconnector as (\n\n    select *\n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__connector`\n\n),\n\ndestination as (\n\n    select * \n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__destination`\n),\n\nconnector_metrics as (\n\n    select\n        connector.connector_id,\n        connector.connector_name,\n        connector.connector_type,\n        connector.destination_id,\n        connector.is_paused,\n        connector.set_up_at,\n        max(case when connector_log.event_subtype = 'sync_start' then connector_log.created_at else null end) as last_sync_started_at,\n\n        max(case when connector_log.event_subtype = 'sync_end' \n            then connector_log.created_at else null end) as last_sync_completed_at,\n\n        max(case when connector_log.event_subtype in ('status', 'sync_end')\n                and \n\n \n  json_extract_scalar(connector_log.message_data, '$.status')\n\n ='SUCCESSFUL'\n            then connector_log.created_at else null end) as last_successful_sync_completed_at,\n\n\n        max(case when connector_log.event_subtype = 'sync_end' \n            then connector_log.sync_batch_id else null end) as last_sync_batch_id,\n\n        max(case when connector_log.event_subtype in ('status', 'sync_end')\n                and \n\n \n  json_extract_scalar(connector_log.message_data, '$.status')\n\n ='RESCHEDULED'\n                and \n\n \n  json_extract_scalar(connector_log.message_data, '$.reason')\n\n like '%intended behavior%'\n            then connector_log.created_at else null end) as last_priority_first_sync_completed_at,\n                \n\n        max(case when connector_log.event_type = 'SEVERE' then connector_log.created_at else null end) as last_error_at,\n\n        max(case when connector_log.event_type = 'SEVERE' then connector_log.sync_batch_id else null end) as last_error_batch,\n        max(case when event_type = 'WARNING' then connector_log.created_at else null end) as last_warning_at\n\n    from connector \n    left join connector_log \n        on connector_log.connector_id = connector.connector_id\n    group by 1,2,3,4,5,6\n\n),\n\nconnector_health as (\n\n    select\n        *,\n        case \n            -- connector is paused\n            when is_paused then 'paused'\n\n            -- a sync has never been attempted\n            when last_sync_started_at is null then 'incomplete'\n\n            -- a priority-first sync has occurred, but a normal sync has not\n            when last_priority_first_sync_completed_at is not null and last_sync_completed_at is null then 'priority first sync'\n\n            -- a priority sync has occurred more recently than a normal one (may occurr if the connector has been paused and resumed)\n            when last_priority_first_sync_completed_at > last_sync_completed_at then 'priority first sync'\n\n            -- a sync has been attempted, but not completed, and it's not due to errors. also a priority-first sync hasn't\n            when last_sync_completed_at is null and last_error_at is null then 'initial sync in progress'\n\n            -- the last attempted sync had an error\n            when last_sync_batch_id = last_error_batch then 'broken'\n\n            -- there's never been a successful sync and there have been errors\n            when last_sync_completed_at is null and last_error_at is not null then 'broken'\n\n        else 'connected' end as connector_health\n\n    from connector_metrics\n),\n\n-- Joining with log to grab pertinent error/warning messagees\nconnector_recent_logs as (\n\n    select \n        connector_health.connector_id,\n        connector_health.connector_name,\n        connector_health.connector_type,\n        connector_health.destination_id,\n        connector_health.connector_health,\n        connector_health.last_successful_sync_completed_at,\n        connector_health.last_sync_started_at,\n        connector_health.last_sync_completed_at,\n        connector_health.set_up_at,\n        connector_log.event_subtype,\n        connector_log.event_type,\n        connector_log.message_data\n\n    from connector_health \n    left join connector_log \n        on connector_log.connector_id = connector_health.connector_id\n        -- limiting relevance to since the last successful sync completion (if there has been one)\n        and connector_log.created_at > coalesce(connector_health.last_sync_completed_at, connector_health.last_priority_first_sync_completed_at, '2000-01-01') \n        -- only looking at errors and warnings (excluding syncs - both normal and priority first)\n        and connector_log.event_type != 'INFO' \n        -- need to explicitly avoid priority first statuses because they are of event_type WARNING\n        and not (connector_log.event_subtype = 'status' \n            and \n\n \n  json_extract_scalar(connector_log.message_data, '$.status')\n\n ='RESCHEDULED'\n            and \n\n \n  json_extract_scalar(connector_log.message_data, '$.reason')\n\n like '%intended behavior%')\n\n    group by 1,2,3,4,5,6,7,8,9,10,11,12 -- de-duping error messages\n    \n\n),\n\nfinal as (\n\n    select\n        connector_recent_logs.connector_id,\n        connector_recent_logs.connector_name,\n        connector_recent_logs.connector_type,\n        connector_recent_logs.destination_id,\n        destination.destination_name,\n        connector_recent_logs.connector_health,\n        connector_recent_logs.last_successful_sync_completed_at,\n        connector_recent_logs.last_sync_started_at,\n        connector_recent_logs.last_sync_completed_at,\n        connector_recent_logs.set_up_at,\n        coalesce(schema_changes.number_of_schema_changes_last_month, 0) as number_of_schema_changes_last_month\n        \n        \n        , \n    string_agg(distinct case when connector_recent_logs.event_type = 'SEVERE' then connector_recent_logs.message_data else null end, '\\n')\n\n as errors_since_last_completed_sync\n        , \n    string_agg(distinct case when connector_recent_logs.event_type = 'WARNING' then connector_recent_logs.message_data else null end, '\\n')\n\n as warnings_since_last_completed_sync\n        \n\n    from connector_recent_logs\n    left join schema_changes \n        on connector_recent_logs.connector_id = schema_changes.connector_id \n\n    join destination on destination.destination_id = connector_recent_logs.destination_id\n    group by 1,2,3,4,5,6,7,8,9,10,11\n)\n\nselect * from final", "relation_name": "`dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`fivetran_platform__connector_status`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:13.137190Z", "completed_at": "2023-11-14T18:04:13.153834Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:13.154378Z", "completed_at": "2023-11-14T18:04:13.154383Z"}], "thread_id": "Thread-2", "execution_time": 0.0202789306640625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.dbt_utils_unique_combination_of_columns_stg_fivetran_platform__log_log_id__created_at.c406abd91d", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        log_id, created_at\n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__log`\n    group by log_id, created_at\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:13.147026Z", "completed_at": "2023-11-14T18:04:13.155281Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:13.157478Z", "completed_at": "2023-11-14T18:04:13.157481Z"}], "thread_id": "Thread-3", "execution_time": 0.02234172821044922, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.fivetran_platform__usage_mar_destination_history", "compiled": true, "compiled_code": "with table_mar as (\n    \n    select *\n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`fivetran_platform__mar_table_history`\n),\n\ncredits_used as (\n\n    select *\n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__credits_used`\n),\n\nuseage_cost as (\n\n    select *\n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__usage_cost`\n),\n\ndestination_mar as (\n\n    select \n        measured_month,\n        destination_id,\n        destination_name,\n        sum(free_monthly_active_rows) as free_monthly_active_rows,\n        sum(paid_monthly_active_rows) as paid_monthly_active_rows,\n        sum(total_monthly_active_rows) as total_monthly_active_rows\n    from table_mar\n    group by 1,2,3\n),\n\nusage as (\n\n    select \n        coalesce(credits_used.destination_id, useage_cost.destination_id) as destination_id,\n        credits_used.credits_spent,\n        useage_cost.dollars_spent,\n        cast(concat(coalesce(credits_used.measured_month,useage_cost.measured_month), '-01') as date) as measured_month -- match date format to join with MAR table\n    from credits_used\n    full outer join useage_cost\n        on useage_cost.measured_month = credits_used.measured_month\n        and useage_cost.destination_id = credits_used.destination_id\n),\n\njoin_usage_mar as (\n\n    select \n        destination_mar.measured_month,\n        destination_mar.destination_id,\n        destination_mar.destination_name,\n        usage.credits_spent,\n        usage.dollars_spent,\n        destination_mar.free_monthly_active_rows,\n        destination_mar.paid_monthly_active_rows,\n        destination_mar.total_monthly_active_rows,\n\n        -- credit and usage mar calculations\n        round( cast(nullif(usage.credits_spent,0) * 1000000.0 as numeric) / cast(nullif(destination_mar.total_monthly_active_rows,0) as numeric), 2) as credits_spent_per_million_mar,\n        round( cast(nullif(destination_mar.total_monthly_active_rows,0) * 1.0 as numeric) / cast(nullif(usage.credits_spent,0) as numeric), 0) as mar_per_credit_spent,\n        round( cast(nullif(usage.dollars_spent,0) * 1000000.0 as numeric) / cast(nullif(destination_mar.total_monthly_active_rows,0) as numeric), 2) as amount_spent_per_million_mar,\n        round( cast(nullif(destination_mar.total_monthly_active_rows,0) * 1.0 as numeric) / cast(nullif(usage.dollars_spent,0) as numeric), 0) as mar_per_amount_spent\n    from destination_mar \n    left join usage \n        on destination_mar.measured_month = cast(usage.measured_month as timestamp)\n        and destination_mar.destination_id = usage.destination_id\n)\n\nselect * \nfrom join_usage_mar\norder by measured_month desc", "relation_name": "`dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`fivetran_platform__usage_mar_destination_history`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:13.141275Z", "completed_at": "2023-11-14T18:04:13.155542Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:13.157755Z", "completed_at": "2023-11-14T18:04:13.157759Z"}], "thread_id": "Thread-1", "execution_time": 0.023931264877319336, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.not_null_fivetran_platform__audit_user_activity_log_id.db973498ba", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect log_id\nfrom `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`fivetran_platform__audit_user_activity`\nwhere log_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:13.144185Z", "completed_at": "2023-11-14T18:04:13.155818Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:13.158021Z", "completed_at": "2023-11-14T18:04:13.158023Z"}], "thread_id": "Thread-4", "execution_time": 0.024039030075073242, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.unique_fivetran_platform__audit_user_activity_log_id.2662c08a2a", "compiled": true, "compiled_code": "\n    \n    \n\nwith dbt_test__target as (\n\n  select log_id as unique_field\n  from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`fivetran_platform__audit_user_activity`\n  where log_id is not null\n\n)\n\nselect\n    unique_field,\n    count(*) as n_records\n\nfrom dbt_test__target\ngroup by unique_field\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:13.160060Z", "completed_at": "2023-11-14T18:04:13.166422Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:13.191681Z", "completed_at": "2023-11-14T18:04:13.191687Z"}], "thread_id": "Thread-2", "execution_time": 0.03583216667175293, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.dbt_utils_unique_combination_of_columns_fivetran_platform__mar_table_history_connector_id__destination_id__schema_name__table_name__measured_month.b7babb1441", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        connector_id, destination_id, schema_name, table_name, measured_month\n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`fivetran_platform__mar_table_history`\n    group by connector_id, destination_id, schema_name, table_name, measured_month\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:13.187641Z", "completed_at": "2023-11-14T18:04:13.194288Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:13.196496Z", "completed_at": "2023-11-14T18:04:13.196501Z"}], "thread_id": "Thread-4", "execution_time": 0.03123617172241211, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.fivetran_platform__schema_changelog", "compiled": true, "compiled_code": "with schema_changes as (\n\n    select *\n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__log`\n\n    where event_subtype in ('create_table', 'alter_table', 'create_schema', 'change_schema_config')\n),\n\nconnector as (\n\n    select *\n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`fivetran_platform__connector_status`\n),\n\nadd_connector_info as (\n\n    select \n        schema_changes.*,\n        connector.connector_name,\n        connector.destination_id,\n        connector.destination_name\n\n    from schema_changes join connector using(connector_id)\n),\n\nfinal as (\n\n    select\n        connector_id,\n        connector_name,\n        destination_id,\n        destination_name,\n        created_at,\n        event_subtype,\n        message_data,\n\n        case \n        when event_subtype = 'alter_table' then \n\n \n  json_extract_scalar(message_data, '$.table')\n\n \n        when event_subtype = 'create_table' then \n\n \n  json_extract_scalar(message_data, '$.name')\n\n \n        else null end as table_name,\n\n        case \n        when event_subtype = 'create_schema' or event_subtype = 'create_table' then \n\n \n  json_extract_scalar(message_data, '$.schema')\n\n \n        else null end as schema_name\n    \n    from add_connector_info\n)\n\nselect * from final\norder by created_at desc, connector_id", "relation_name": "`dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`fivetran_platform__schema_changelog`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:13.197658Z", "completed_at": "2023-11-14T18:04:13.205156Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:13.205721Z", "completed_at": "2023-11-14T18:04:13.205725Z"}], "thread_id": "Thread-2", "execution_time": 0.010305166244506836, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.dbt_utils_unique_combination_of_columns_fivetran_platform__connector_status_connector_id__destination_id.1d83a6dd89", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        connector_id, destination_id\n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`fivetran_platform__connector_status`\n    group by connector_id, destination_id\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:13.201958Z", "completed_at": "2023-11-14T18:04:13.206820Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:13.208121Z", "completed_at": "2023-11-14T18:04:13.208125Z"}], "thread_id": "Thread-4", "execution_time": 0.010675907135009766, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.dbt_utils_unique_combination_of_columns_fivetran_platform__usage_mar_destination_history_destination_id__measured_month.05f6419efd", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        destination_id, measured_month\n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`fivetran_platform__usage_mar_destination_history`\n    group by destination_id, measured_month\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:13.208396Z", "completed_at": "2023-11-14T18:04:13.212642Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:13.213180Z", "completed_at": "2023-11-14T18:04:13.213184Z"}], "thread_id": "Thread-2", "execution_time": 0.006512165069580078, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.dbt_utils_unique_combination_of_columns_fivetran_platform__schema_changelog_connector_id__destination_id__message_data__created_at.cc39f64493", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        connector_id, destination_id, message_data, created_at\n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`fivetran_platform__schema_changelog`\n    group by connector_id, destination_id, message_data, created_at\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:13.167627Z", "completed_at": "2023-11-14T18:04:14.853963Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:14.855321Z", "completed_at": "2023-11-14T18:04:14.855339Z"}], "thread_id": "Thread-3", "execution_time": 1.6913261413574219, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.fivetran_platform__audit_table", "compiled": true, "compiled_code": "\n\nwith sync_log as (\n    \n    select \n        *,\n        \n\n \n  json_extract_scalar(message_data, '$.table')\n\n as table_name\n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__log`\n    where event_subtype in ('sync_start', 'sync_end', 'write_to_table_start', 'write_to_table_end', 'records_modified')\n\n    \n\n    -- Capture the latest timestamp in a call statement instead of a subquery for optimizing BQ costs on incremental runs-- load the result from the above query into a new variable-- the query_result is stored as a dataframe. Therefore, we want to now store it as a singular value.-- compare the new batch of data to the latest sync already stored in this model\n    and date(created_at) > '2021-12-10'\n\n    \n),\n\n\nconnector as (\n\n    select *\n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`fivetran_platform__connector_status`\n),\n\nadd_connector_info as (\n\n    select \n        sync_log.*,\n        connector.connector_name,\n        connector.destination_id,\n        connector.destination_name\n    from sync_log \n    left join connector\n        on connector.connector_id = sync_log.connector_id\n),\n\nsync_timestamps as (\n\n    select\n        connector_id,\n        connector_name,\n        table_name,\n        event_subtype,\n        destination_id,\n        destination_name,\n        created_at as write_to_table_start,\n        min(case when event_subtype = 'write_to_table_end' then created_at else null end) \n            over (partition by connector_id, table_name order by created_at ROWS between CURRENT ROW AND UNBOUNDED FOLLOWING) as write_to_table_end,\n\n        max(case when event_subtype = 'sync_start' then created_at else null end) \n            over (partition by connector_id order by created_at ROWS between UNBOUNDED PRECEDING and CURRENT ROW) as sync_start,\n\n        min(case when event_subtype = 'sync_end' then created_at else null end) \n            over (partition by connector_id order by created_at ROWS between CURRENT ROW AND UNBOUNDED FOLLOWING) as sync_end, -- coalesce with next_sync_start\n\n        min(case when event_subtype = 'sync_start' then created_at else null end) \n            over (partition by connector_id order by created_at ROWS between CURRENT ROW AND UNBOUNDED FOLLOWING) as next_sync_start\n    from add_connector_info\n),\n\n-- this will be the base for every record in the final CTE\nlimit_to_table_starts as (\n\n    select *\n    from sync_timestamps \n    where event_subtype = 'write_to_table_start'\n),\n\nrecords_modified_log as (\n\n    select \n        connector_id,\n        created_at,\n        \n\n \n  json_extract_scalar(message_data, '$.table')\n\n as table_name,\n        \n\n \n  json_extract_scalar(message_data, '$.schema')\n\n as schema_name,\n        \n\n \n  json_extract_scalar(message_data, '$.operationType')\n\n as operation_type,\n        cast (\n\n \n  json_extract_scalar(message_data, '$.count')\n\n as INT64) as row_count\n    from sync_log \n    where event_subtype = 'records_modified'\n\n),\n\nsum_records_modified as (\n\n    select\n        limit_to_table_starts.connector_id,\n        limit_to_table_starts.connector_name,\n        coalesce(records_modified_log.schema_name, limit_to_table_starts.connector_name) as schema_name,\n        limit_to_table_starts.table_name,\n        limit_to_table_starts.destination_id,\n        limit_to_table_starts.destination_name,\n        limit_to_table_starts.write_to_table_start,\n        limit_to_table_starts.write_to_table_end,\n        limit_to_table_starts.sync_start,\n        case when limit_to_table_starts.sync_end > limit_to_table_starts.next_sync_start then null else limit_to_table_starts.sync_end end as sync_end,\n        sum(case when records_modified_log.operation_type = 'REPLACED_OR_INSERTED' then records_modified_log.row_count else 0 end) as sum_rows_replaced_or_inserted,\n        sum(case when records_modified_log.operation_type = 'UPDATED' then records_modified_log.row_count else 0 end) as sum_rows_updated,\n        sum(case when records_modified_log.operation_type = 'DELETED' then records_modified_log.row_count else 0 end) as sum_rows_deleted\n    from limit_to_table_starts\n    left join records_modified_log on \n        limit_to_table_starts.connector_id = records_modified_log.connector_id\n        and limit_to_table_starts.table_name = records_modified_log.table_name\n\n        -- confine it to one sync\n        and records_modified_log.created_at > limit_to_table_starts.sync_start \n        and records_modified_log.created_at < coalesce(limit_to_table_starts.sync_end, limit_to_table_starts.next_sync_start) \n\n    group by 1,2,3,4,5,6,7,8,9,10\n),\n\nfinal as (\n\n    select \n        *,\n        to_hex(md5(cast(coalesce(cast(schema_name as string), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(connector_id as string), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(destination_id as string), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(table_name as string), '_dbt_utils_surrogate_key_null_') || '-' || coalesce(cast(write_to_table_start as string), '_dbt_utils_surrogate_key_null_') as string))) as unique_table_sync_key, -- for incremental materialization \n        timestamp_trunc(\n        cast(sync_start as timestamp),\n        day\n    ) as sync_start_day -- for partitioning in databricks\n    from sum_records_modified\n)\n\nselect *\nfrom final", "relation_name": "`dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`fivetran_platform__audit_table`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:14.868737Z", "completed_at": "2023-11-14T18:04:14.874675Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:14.876460Z", "completed_at": "2023-11-14T18:04:14.876469Z"}], "thread_id": "Thread-2", "execution_time": 0.017674922943115234, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.unique_fivetran_platform__audit_table_unique_table_sync_key.308ad058f7", "compiled": true, "compiled_code": "\n    \n    \n\nwith dbt_test__target as (\n\n  select unique_table_sync_key as unique_field\n  from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`fivetran_platform__audit_table`\n  where unique_table_sync_key is not null\n\n)\n\nselect\n    unique_field,\n    count(*) as n_records\n\nfrom dbt_test__target\ngroup by unique_field\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:14.861698Z", "completed_at": "2023-11-14T18:04:14.875192Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:14.876904Z", "completed_at": "2023-11-14T18:04:14.876910Z"}], "thread_id": "Thread-4", "execution_time": 0.01937413215637207, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.not_null_fivetran_platform__audit_table_unique_table_sync_key.d6c37e48af", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect unique_table_sync_key\nfrom `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`fivetran_platform__audit_table`\nwhere unique_table_sync_key is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:13.179994Z", "completed_at": "2023-11-14T18:04:15.801791Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:15.803195Z", "completed_at": "2023-11-14T18:04:15.803216Z"}], "thread_id": "Thread-1", "execution_time": 2.6387901306152344, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.fivetran_log.fivetran_platform__connector_daily_events", "compiled": true, "compiled_code": "-- depends_on: `dbt-package-testing`.`fivetran_platform_integration_tests_1`.`connector`\n\nwith connector as (\n    \n    select * \n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`fivetran_platform__connector_status`\n),\n\n-- grab api calls, schema changes, and record modifications\nlog_events as (\n\n    select \n        connector_id,\n        cast( timestamp_trunc(\n        cast(created_at as timestamp),\n        day\n    ) as date) as date_day,\n        case \n            when event_subtype in ('create_table', 'alter_table', 'create_schema', 'change_schema_config') then 'schema_change' \n            else event_subtype end as event_subtype,\n\n        sum(case when event_subtype = 'records_modified' then cast( \n\n \n  json_extract_scalar(message_data, '$.count')\n\n as INT64 )\n        else 1 end) as count_events \n\n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`stg_fivetran_platform__log`\n\n    where event_subtype in ('api_call', \n                            'records_modified', \n                            'create_table', 'alter_table', 'create_schema', 'change_schema_config') -- all schema changes\n                            \n        and connector_id is not null\n\n    group by 1,2,3\n),\n\npivot_out_events as (\n\n    select\n        connector_id,\n        date_day,\n        max(case when event_subtype = 'api_call' then count_events else 0 end) as count_api_calls,\n        max(case when event_subtype = 'records_modified' then count_events else 0 end) as count_record_modifications,\n        max(case when event_subtype = 'schema_change' then count_events else 0 end) as count_schema_changes\n\n    from log_events\n    group by 1,2\n),\n\nconnector_event_counts as (\n\n    select\n        pivot_out_events.date_day,\n        pivot_out_events.count_api_calls,\n        pivot_out_events.count_record_modifications,\n        pivot_out_events.count_schema_changes,\n        connector.connector_name,\n        connector.connector_id,\n        connector.connector_type,\n        connector.destination_name,\n        connector.destination_id,\n        connector.set_up_at\n    from\n    connector left join pivot_out_events \n        on pivot_out_events.connector_id = connector.connector_id\n),\n\nspine as (\n\n    \n    \n    \n    \n    \n\n    \n\n\n\n\n\nwith rawdata as (\n\n    \n\n    \n\n    with p as (\n        select 0 as generated_number union all select 1\n    ), unioned as (\n\n    select\n\n    \n    p0.generated_number * power(2, 0)\n     + \n    \n    p1.generated_number * power(2, 1)\n     + \n    \n    p2.generated_number * power(2, 2)\n     + \n    \n    p3.generated_number * power(2, 3)\n     + \n    \n    p4.generated_number * power(2, 4)\n     + \n    \n    p5.generated_number * power(2, 5)\n     + \n    \n    p6.generated_number * power(2, 6)\n     + \n    \n    p7.generated_number * power(2, 7)\n     + \n    \n    p8.generated_number * power(2, 8)\n     + \n    \n    p9.generated_number * power(2, 9)\n     + \n    \n    p10.generated_number * power(2, 10)\n    \n    \n    + 1\n    as generated_number\n\n    from\n\n    \n    p as p0\n     cross join \n    \n    p as p1\n     cross join \n    \n    p as p2\n     cross join \n    \n    p as p3\n     cross join \n    \n    p as p4\n     cross join \n    \n    p as p5\n     cross join \n    \n    p as p6\n     cross join \n    \n    p as p7\n     cross join \n    \n    p as p8\n     cross join \n    \n    p as p9\n     cross join \n    \n    p as p10\n    \n    \n\n    )\n\n    select *\n    from unioned\n    where generated_number <= 1705\n    order by generated_number\n\n\n\n),\n\nall_periods as (\n\n    select (\n        \n\n        datetime_add(\n            cast( cast('2019-03-22' as date) as datetime),\n        interval row_number() over (order by 1) - 1 day\n        )\n\n\n    ) as date_day\n    from rawdata\n\n),\n\nfiltered as (\n\n    select *\n    from all_periods\n    where date_day <= \n\n        datetime_add(\n            cast( timestamp_trunc(\n        cast(current_timestamp as timestamp),\n        day\n    ) as datetime),\n        interval 1 week\n        )\n\n\n\n)\n\nselect * from filtered\n\n \n),\n\nconnector_event_history as (\n\n    select\n        cast(spine.date_day as date) as date_day,\n        connector_event_counts.connector_name,\n        connector_event_counts.connector_id,\n        connector_event_counts.connector_type,\n        connector_event_counts.destination_name,\n        connector_event_counts.destination_id,\n        max(case \n            when cast(spine.date_day as date) = connector_event_counts.date_day then connector_event_counts.count_api_calls\n            else 0\n        end) as count_api_calls,\n        max(case \n            when cast(spine.date_day as date) = connector_event_counts.date_day then connector_event_counts.count_record_modifications\n            else 0\n        end) as count_record_modifications,\n        max(case \n            when cast(spine.date_day as date) = connector_event_counts.date_day then connector_event_counts.count_schema_changes\n            else 0\n        end) as count_schema_changes\n    from\n    spine join connector_event_counts\n        on spine.date_day  >= cast( timestamp_trunc(\n        cast(connector_event_counts.set_up_at as timestamp),\n        day\n    ) as date)\n\n    group by 1,2,3,4,5,6\n),\n\n-- now rejoin spine to get a complete calendar\njoin_event_history as (\n    \n    select\n        spine.date_day,\n        connector_event_history.connector_name,\n        connector_event_history.connector_id,\n        connector_event_history.connector_type,\n        connector_event_history.destination_name,\n        connector_event_history.destination_id,\n        max(connector_event_history.count_api_calls) as count_api_calls,\n        max(connector_event_history.count_record_modifications) as count_record_modifications,\n        max(connector_event_history.count_schema_changes) as count_schema_changes\n\n    from\n    spine left join connector_event_history\n        on cast(spine.date_day as date) = connector_event_history.date_day\n\n    group by 1,2,3,4,5,6\n),\n\nfinal as (\n\n    select *\n    from join_event_history\n\n    where cast(date_day as timestamp) <= current_timestamp\n\n    order by date_day desc\n)\n\nselect *\nfrom final", "relation_name": "`dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`fivetran_platform__connector_daily_events`"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2023-11-14T18:04:15.808514Z", "completed_at": "2023-11-14T18:04:15.816963Z"}, {"name": "execute", "started_at": "2023-11-14T18:04:15.817946Z", "completed_at": "2023-11-14T18:04:15.817954Z"}], "thread_id": "Thread-3", "execution_time": 0.012108087539672852, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.fivetran_log.dbt_utils_unique_combination_of_columns_fivetran_platform__connector_daily_events_connector_id__destination_id__date_day.a279340e8f", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        connector_id, destination_id, date_day\n    from `dbt-package-testing`.`fivetran_platform_integration_tests_1_fivetran_platform`.`fivetran_platform__connector_daily_events`\n    group by connector_id, destination_id, date_day\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null}], "elapsed_time": 4.363950729370117, "args": {"empty_catalog": false, "exclude": [], "log_level": "info", "log_file_max_bytes": 10485760, "project_dir": "/Users/jamie.rodriguez/Desktop/dbt_repos/jamie_dbt_dev/dbt_packages/fivetran_log/integration_tests", "printer_width": 80, "warn_error_options": {"include": [], "exclude": []}, "select": [], "log_level_file": "debug", "use_colors_file": true, "favor_state": false, "use_colors": true, "enable_legacy_logger": false, "macro_debugging": false, "show_resource_report": false, "print": true, "profiles_dir": "/Users/jamie.rodriguez/.dbt", "populate_cache": true, "invocation_command": "dbt docs generate", "defer": false, "introspect": true, "compile": true, "partial_parse": true, "static_parser": true, "send_anonymous_usage_stats": true, "vars": {}, "version_check": true, "write_json": true, "log_format": "default", "quiet": false, "static": false, "log_path": "/Users/jamie.rodriguez/Desktop/dbt_repos/jamie_dbt_dev/dbt_packages/fivetran_log/integration_tests/logs", "strict_mode": false, "partial_parse_file_diff": true, "which": "generate", "log_format_file": "debug", "indirect_selection": "eager", "cache_selected_only": false}}